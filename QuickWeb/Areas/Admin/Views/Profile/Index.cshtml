@model snake_user
@{
    ViewBag.Title = "个人中心";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

@section styles  {
    <link href="~/Content/admin/css/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="~/Assets/croppic/css/croppic.css" rel="stylesheet" />
}

<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-sm-8">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>编辑信息</h5>
                </div>
                <div class="ibox-content">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">修改头像：</label>
                        <div class="input-group col-sm-4">
                            <div id="croppic" style="width:250px;height:340px;position:relative;border:1px solid "></div>
                        </div>
                    </div>

                    <form class="form-horizontal m-t" id="commentForm" method="post" action="@Url.Action("EditInfo")">
                        <input type="hidden" name="head" value="@(Model.head)" id="myOutputId">
                        <div class="form-group">
                            <label class="col-sm-3 control-label">真实姓名：</label>
                            <div class="input-group col-sm-4">
                                <input id="real_name" type="text" class="form-control" name="real_name" value="@(Model.real_name)" placeholder="请输入真实姓名" required="" aria-required="true" />
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-1 col-sm-offset-5">
                                <a class="btn btn-default" href="@Url.Action("Index","Home")">取消</a>
                            </div>
                            <div class="col-sm-1">
                                @Html.AntiForgeryToken()
                                <button class="btn btn-primary" type="submit">提交</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts  {
    <script src="~/Content/admin/js/plugins/validate/jquery.validate.min.js"></script>
    <script src="~/Content/admin/js/plugins/validate/messages_zh.min.js"></script>
    <script src="~/Content/admin/js/plugins/iCheck/icheck.min.js"></script>
    <script src="~/Content/admin/js/jquery.form.js"></script>
    <script src="~/Assets/layer/layer.min.js"></script>
    <script src="~/Assets/croppic/js/croppic.min.js"></script>
    <script type="text/javascript">

        var index = '';
        function showStart() {
            index = layer.load(0, { shade: false });
            return true;
        }

        function showSuccess(res) {
            layer.ready(function () {
                layer.close(index);
                if (1 == res.status) {
                    layer.alert("信息编辑成功！", { title: '友情提示', icon: 1, closeBtn: 0 }, function (self) {
                        layer.close(self);
                        window.location.href = "@Url.Action("Index","Home")";
                    });
                } else if (0 == res.status) {
                    layer.alert(res.msg, { title: '友情提示', icon: 2 });
                } else {
                    window.location.reload();
                }
            });
        }

        //头像上传插件
        function croppicUp() {
            var cropperOptions = {
                uploadUrl: '@Url.Action("uploadHead")', //上传处理url
                cropUrl: '@Url.Action("cropHead")',     //裁剪处理url
                outputUrlId: 'myOutputId',
                modal: true  //黑窗口特效
            }
            //绑定div
            var cropperHeader = new Croppic('croppic', cropperOptions);
        }

        $(document).ready(function () {
            croppicUp();

            $(".i-checks").iCheck({ checkboxClass: "icheckbox_square-green", radioClass: "iradio_square-green", });

            // 编辑管理员
            var options = {
                beforeSubmit: showStart,
                success: showSuccess
            };

            $('#commentForm').submit(function () {
                $(this).ajaxSubmit(options);
                return false;
            });
        });

        // 表单验证
        $.validator.setDefaults({
            highlight: function (e) {
                $(e).closest(".form-group").removeClass("has-success").addClass("has-error");
            },
            success: function (e) {
                e.closest(".form-group").removeClass("has-error").addClass("has-success");
            },
            errorElement: "span",
            errorPlacement: function (e, r) {
                e.appendTo(r.is(":radio") || r.is(":checkbox") ? r.parent().parent().parent() : r.parent())
            },
            errorClass: "help-block m-b-none",
            validClass: "help-block m-b-none"
        });

    </script>
}
